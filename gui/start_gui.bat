@echo off
chcp 65001 >nul
title –¶–†–ü–¢ –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ - –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

echo ================================================
echo üöÄ –ó–∞–ø—É—Å–∫ GUI –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –¶–†–ü–¢ –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞
echo ================================================
echo.

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
python --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Python –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ
    echo üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞: https://python.org
    pause
    exit /b 1
)

:: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é GUI
cd /d "%~dp0"

:: üîß –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ/–∞–∫—Ç–∏–≤–∞—Ü–∏—è)
echo üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è...
setlocal enableextensions
set "ROOT_DIR=%~dp0.."
set "VENV_DIR=%ROOT_DIR%\.venv"
set "VENV_PY=%VENV_DIR%\Scripts\python.exe"
set "VENV_ACT=%VENV_DIR%\Scripts\activate.bat"

if exist "%VENV_PY%" (
    echo ‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: "%VENV_DIR%"
) else (
    echo üìÇ –°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ "%VENV_DIR%"...
    python -m venv "%VENV_DIR%"
    if errorlevel 1 (
        echo ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
        pause
        exit /b 1
    )
)

:: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥ Windows (cmd)
if exist "%VENV_ACT%" (
    call "%VENV_ACT%"
) else (
    echo ‚ö†Ô∏è –§–∞–π–ª –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂—É —Å –ø—Ä—è–º—ã–º –ø—É—Ç—ë–º –∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä—É
)

:: –ò—Å–ø–æ–ª—å–∑—É–µ–º python –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø—Ä–∏ —Å–±–æ–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ‚Äî –ø—Ä—è–º–æ–π –ø—É—Ç—å
set "PYTHON=%VENV_PY%"
if not exist "%PYTHON%" set "PYTHON=python"

echo üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º PyQt6
%PYTHON% -c "import PyQt6" >nul 2>&1
if errorlevel 1 (
    echo üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PyQt6...
    %PYTHON% -m pip install PyQt6
    if errorlevel 1 (
        echo ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PyQt6
        pause
        exit /b 1
    )
    echo ‚úÖ PyQt6 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
)

:: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ GUI
if exist requirements.txt (
    echo üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ GUI...
    %PYTHON% -m pip install -r requirements.txt >nul 2>&1
)

:: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
if exist "..\scripts\requirements.txt" (
    echo üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã...
    %PYTHON% -m pip install -r "..\scripts\requirements.txt" >nul 2>&1
)

echo.
echo üé® –ó–∞–ø—É—Å–∫ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...
echo.

:: –ó–∞–ø—É—Å–∫–∞–µ–º GUI
%PYTHON% launcher.py

:: –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
if errorlevel 1 (
    echo.
    echo ‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ GUI
    echo üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å: %PYTHON% main_window.py
    echo.
    pause
)
